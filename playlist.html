<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Premium | El Basurero</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="icon" href="Imagenes/icono.png" type="image/x-icon">
</head>
<body style="display:none;">
  <div id="header"></div>

  <main class="playlist-container">
    <h1>Premium</h1>
    <p>Bienvenido a tu contenido exclusivo.</p>

    <!-- Barra de búsqueda -->
    <div class="search-container">
      <input type="text" id="searchInput" placeholder="Buscar series, episodios o reacciones...">
      <button id="clearSearch" style="display: none;">Limpiar</button>
    </div>

    <!-- Grid de tarjetas de listas -->
    <div class="premium-grid" id="playlistList"></div>
  </main>

  <div id="footer"></div>

  <script src="js/scripts.js"></script>
  <script type="module">
  import { protectPage } from "./js/roleManager.js";
  import "./js/login.js";
  import { videosPremium, categoriasData } from "./js/videos-premium.js";

  protectPage(["premium", "admin"], "index.html");

  // Cargar header y footer
  fetch('header.html').then(r => r.text()).then(d => {
    document.getElementById('header').innerHTML = d;
    window.initAuthButtons();
  });
  fetch('footer.html').then(r => r.text()).then(d => document.getElementById('footer').innerHTML = d);

  // === AGRUPAR POR CATEGORÍA ===
  const grouped = videosPremium.reduce((acc, v) => {
    const key = v.name || 'Otros';
    if (!acc[key]) acc[key] = [];
    acc[key].push(v);
      return acc;
    }, {});

    // === PORTADAS PERSONALIZADAS (sube estas imágenes a GitHub) ===
    const covers = {
      'Shingeki no Kyojin': 'Imagenes/Picsart_25-10-18_01-10-37-858.jpg',
      'Nada': 'Imagenes/nada portada.webp',
      'MillenNium': 'Imagenes/Picsart_25-10-24_19-36-11-553.jpg',
      'les luthiers': 'Imagenes/les-luthiers-1486327.jpg',
      'El Encargado': 'Imagenes/el encargado portada.webp',
      'Bloqueados de YouTubee': 'Imagenes/Picsart_25-10-18_02-01-51-724.jpg',
      

      // Agrega más...
    };

    // === GENERAR URL AMIGABLE ===
    function slugify(text) {
      return text.toLowerCase()
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/(^-|-$)/g, '');
    }

// === RENDERIZAR TARJETAS DE LISTAS ===
const container = document.getElementById('playlistList'); // ← ¡AQUÍ ESTABA EL PROBLEMA!
Object.keys(grouped).forEach(name => {
  const videos = grouped[name];
  const slug = slugify(name);

  // Buscar datos de categoría
  const catKey = Object.keys(categoriasData).find(key => 
    categoriasData[key].name === name
  );
  const catData = catKey ? categoriasData[catKey] : null;

  // Usar background del catData o del primer video
  const background = catData?.background || videos[0]?.thumbnail || 'Imagenes/default.jpg';

  const card = document.createElement('div');
  card.className = 'premium-card playlist-card';

  card.innerHTML = `
    <a href="categorias.html?cat=${slug}">
      <img src="${background}" alt="${name}" loading="lazy">
      <div class="premium-info">
        <h2>${name}</h2>
        <p class="playlist-count">${videos.length} videos</p>
      </div>
    </a>
  `;

  container.appendChild(card);
});

    // === BÚSQUEDA LOCAL (opcional, filtra listas) ===
    const searchInput = document.getElementById('searchInput');
    const clearBtn = document.getElementById('clearSearch');

    searchInput.addEventListener('input', () => {
      const q = searchInput.value.toLowerCase().trim();
      clearBtn.style.display = q ? 'inline-block' : 'none';

      document.querySelectorAll('.playlist-card').forEach(card => {
        const title = card.querySelector('h2').textContent.toLowerCase();
        card.style.display = title.includes(q) ? 'block' : 'none';
      });
    });

    clearBtn.addEventListener('click', () => {
      searchInput.value = '';
      clearBtn.style.display = 'none';
      document.querySelectorAll('.playlist-card').forEach(c => c.style.display = 'block');
    });

    document.body.style.display = 'block';
  </script>
</body>
</html>